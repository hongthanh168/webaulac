@*@model IEnumerable<WebAuLac.Models.HRM_EMPLOYEE>*@
@model dynamic
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@*<div>
    <div class="row" style="padding-bottom:20px;padding-top:20px;">
        <div class="col-md-12 col-xs-12 text-center">
            <button name="btndd" id="btndd" class="btn btn-success">Nhập quyết định điều động</button>
        </div>
    </div>
</div>*@
<table id="QuyetDinhList2" class="table table-striped jambo_table border-right action-table display">
    <thead>
        <tr>
            <th></th>
            <th>Họ tên</th>
            <th>Số QĐ</th>
            <th>Ngày QĐ</th>
            <th>Ngày hiệu lực</th>
            <th>Phòng ban</th>
            <th>Chức vụ</th>
            <th>Ngày xuống tàu</th>
            <th>Xác nhận</th>
 
            <th></th>

        </tr>
    </thead>

    <tbody>
                @foreach (var item in Model)
                {
                    //string rowID = "HRM_EMPLOYEE_" + item.EmploymentHistoryID;
                    //string ma = item.EmploymentHistoryID.toString();

                    @*<tr id="@rowID">*@
                    <tr>
                        <td></td>
                        <td>@item.HOTEN</td>
                        <td>@item.SOQUYETDINH</td>
                        @if (@item.NGAYQUYETDINH != null)
                        {
                            <td>@item.NGAYQUYETDINH.ToString("dd/MM/yyyy")</td>
                        }
                        else
                        { <td>@item.NGAYQUYETDINH</td>}
                       @if (@item.NGAYHIEULUC != null)
                       {
                        <td>@item.NGAYHIEULUC.ToString("dd/MM/yyyy")</td>
                       }
                       else
                       {<td>@item.NGAYHIEULUC</td>}

                         
                        <td>@item.PHONGBAN</td>
                        <td>@item.CHUCVU</td>
@if (@item.NgayXuongTau != null)
{
    <td>@item.NgayXuongTau.ToString("dd/MM/yyyy")</td>
}
else
{  <td>@item.NgayXuongTau</td>}
                         
                        <td>@item.XacNhan</td>
                        <td>
                            <a href="@Url.Action("EditXacNhan", "HRM_EMPLOYMENTHISTORY", new { id =item.EmploymentHistoryID})" class="btn btn-success btn-xs" data-modal><i class="fa fa-edit"></i></a>
                            @*<a href="@Url.Action("XuatQuyetDinhDieuDongCaNhan", "HRM_QuyetDinhDieuDong", new { QuyetDinhID =item.HistoryID })" class="btn btn-success btn-xs" target="_blank"><i class="fa fa-file-excel-o"></i></a>*@
                        </td>
                    </tr>
        }
    </tbody>

</table>

@section Styles{
    @Styles.Render("~/vendors/DataTables/css")
    @Styles.Render("~/vendors/DataTables/Buttons/css")
    <style>
        .row_selected {
            color: red !important;
        }
    </style>
}

@section scripts{
    @Scripts.Render("~/vendors/DataTables/js")
    @Scripts.Render("~/vendors/DataTables/Buttons/js")
    @Scripts.Render("~/bundles/jqueryval")
    <!--modal form-->
    @Scripts.Render("~/bundles/modalform")

    <script language="javascript">

        $(document).ready(function () {
            var t = $('#QuyetDinhList2').DataTable({

                "language": {
                    "url": "/vendors/DataTables/langs/Vietnamese.json"
                },
                "columnDefs": [{
                    "searchable": false,
                    "orderable": false,
                    //"className": 'select-checkbox',
                    "targets": 1
                },
                {
                    "searchable": false,
                    "orderable": false,
                    "targets":9
                }//,
                //{

                //    "visible": false,
                //    "targets": 0
                //},

                ]//,
                //"select": {
                //    "style": 'os',
                //    "selector": 'td:first-child'
                //}

            });
            t.on('order.dt search.dt', function () {
                t.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            }).draw();

            //setInterval(function () { t.ajax.reload('null',false); }, 30000);

            @*$('#btndd').click(function () {
                var listEmployeeID = [];
                //alert(t.rows('.selected').data().length + ' row(s) selected');
                var count = 0;
                $.each(t.rows('.selected').data(), function () {
                    listEmployeeID[count] = this[1] ;
                    //alert(listEmployeeID[count]);
                    count++;

                });



                      $.ajax({
                          type: "POST",
                          traditional: true,
                          url: '@Url.Action("XuatBaoCao", "HRM_QuyetDinhDieuDong")',
                          data: JSON.stringify({ function_param: listEmployeeID}),
                          contentType: "application/json; charset=utf-8",
                          async: true,
                          cache: false,
                          success: function (data) {
                              //alert(data.p);
                              //GỌi thực thi hàm tạo mới
                              window.location.href = '@Url.Action("CreateEachList", "HRM_EMPLOYMENTHISTORY")';
                              //window.location.href = '@Url.Action("CreateEachList", "HRM_EMPLOYMENTHISTORY")?EmployeeID=' + data.e + '&PlanID=' + data.p + '&detailPlanID=' + data.d;
                              },
                          error: function () {
                                  alert("Có lỗi xảy ra");
                              }
                          });
                //var ids = $.map(table.rows('.selected').data(), function (item) {
                //    return item[1];
                //});
                //alert(ids);

                // alert(table.rows('.selected').data().length + ' row(s) selected');
                      });*@
        });



        //$(function () {
        //    setInterval(function () { $('#EmployeesList2').DataTable().ajax.reload('/HRM_EMPLOYEE2/Index'); }, 3000); // every 3 sec
        //});
    //var table;
    //    var EmployeeID;
    //    function HienThiModal(href) {
    //        $('#ddModalContent').load(href, function () {
    //            // this is the first add
    //            $.validator.unobtrusive.parse($('form'));
    //            $('#ddModal').modal({
    //                /*backdrop: 'static',*/
    //                keyboard: true
    //            }, 'show');
    //            bindFormEmployeeDegree(this);
    //        });
    //    };
        //function bindFormEmployeeDegree(dialog) {
        //    $('form', dialog).submit(function () {
        //        var data = $(this).serialize();
        //        // this is the second addition
        //        if ($(this).valid()) {
        //            $.ajax({
        //                url: this.action,
        //                type: this.method,
        //                data: data,
        //                success: function (result) {
        //                    //đóng modal form
        //                    $("#ddModal").modal('hide');
        //                    //load lại bảng
        //                    LoadEmployeeTable(EmployeeID);

        //                }
        //            });
        //            return false;
        //        }
        //    });
        //}

        //$("#EmployeesList2 tbody tr").on('click', function (event) {

        //});
         @*$('#EmployeesList2 tr').dblclick(function () {

            $("#EmployeesList2 tbody tr").removeClass('row_selected');
            $(this).addClass('row_selected');
            var id = $(this).attr('id');
            id = id.replace('HRM_EMPLOYEE_', '');
            var values = id.split('|');

            var idtv = values[0];
            var idkh = values[1];
            var idctkh = values[2];
            EmployeeID = id;
            LoadEmployeeTable(EmployeeID);
            var url = '@Url.Action("Employees", "HRM_EMPLOYEE_ACCIDENT", new { AccidentID = "js-id", data_modal="" })'
           .replace("js-id", encodeURIComponent(id));

            $.get(url, function (data) {
                if (document.getElementById("rowOfEmployees") == null) {
                    $('#rowsOfContent').append("<div id='rowOfEmployees' class='col-md-12'></div>");
                }
                $('#rowOfEmployees').html(data);
                //----------thực hiện hiển thị dạng datatable---------------------
                table = $('#Employee_AccidentList').DataTable({
                    "language": {
                        "url": "/vendors/DataTables/langs/Vietnamese.json"
                    },
                    "columnDefs": [{
                        "searchable": false,
                        "orderable": false,
                        "targets": 0
                    },
                    {
                        "searchable": false,
                        "orderable": false,
                        "targets": 4
                    },
                    ],
                    "order": [[1, 'asc']]
                });
                table.on('order.dt search.dt', function () {
                    table.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();
                //-------------hết phần hiển thị datatable--------------------
            });
        })

         function LoadEmployeeTable(EmployeeID) {
            var url = '@Url.Action("Employees", "HRM_EMPLOYMENTHISTORY", new { EmployeeID = "js-id", data_modal="" })'
              .replace("js-id", encodeURIComponent(EmployeeID));
            $.get(url, function (data) {
                if (document.getElementById("rowOfEmployees") == null) {
                    $('#rowsOfContent').append("<div id='rowOfEmployees' class='col-md-12'></div>");
                }
                $('#rowOfEmployees').html(data);
                //----------thực hiện hiển thị dạng datatable---------------------
                table = $('#Employee_HistoryList').DataTable({
                    "language": {
                        "url": "/vendors/DataTables/langs/Vietnamese.json"
                    },
                    "columnDefs": [{
                        "searchable": false,
                        "orderable": false,
                        "targets": 0
                    },
                    {
                        "searchable": false,
                        "orderable": false,
                        "targets": 10
                    },
                    ],
                    "order": [[1, 'asc']]
                });
                table.on('order.dt search.dt', function () {
                    table.column(0, { search: 'applied', order: 'applied' }).nodes().each(function (cell, i) {
                        cell.innerHTML = i + 1;
                    });
                }).draw();
                //-------------hết phần hiển thị datatable--------------------
            });

        }*@
    </script>
}





